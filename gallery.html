<div id="gallery-container">
    <style>
        /* Forces the 3x2 grid even with different image sizes */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 20px;
        }
        @media (min-width: 600px) {
            .gallery-grid { grid-template-columns: repeat(3, 1fr); }
        }

        /* Uniform Image Containers */
        .gallery-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            text-align: center;
        }
        .gallery-img-box {
            width: 100%;
            aspect-ratio: 4/3; /* Forces uniform size */
            object-fit: cover; /* Crops center to fit box */
            border-radius: 12px;
            border: 1px solid #eee;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 8px;
        }
        .gallery-label {
            font-weight: 800;
            font-size: 11px;
            text-transform: uppercase;
            color: #002f54; /* Brand Blue */
        }

        /* Fullscreen Viewer */
        #fs-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 5000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        #fs-img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .fs-close { position: absolute; top: 40px; right: 20px; color: white; cursor: pointer; }
        .fs-nav {
            position: absolute;
            top: 50%; width: 100%;
            display: flex;
            justify-content: space-around;
            transform: translateY(-50%);
            pointer-events: none;
        }
        .fs-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 20px;
            border-radius: 50%;
            pointer-events: auto;
            cursor: pointer;
        }
    </style>

    <div id="album-view" class="gallery-grid">
        <div class="gallery-item" onclick="loadAlbum('Edwardian')">
            <img src="Gallery/Thumbnails/Edwardian.jpg" class="gallery-img-box">
            <span class="gallery-label">Edwardian</span>
        </div>
        <div class="gallery-item" onclick="loadAlbum('Flat Roof')">
            <img src="Gallery/Thumbnails/Flat Roof.JPG" class="gallery-img-box">
            <span class="gallery-label">Flat Roof</span>
        </div>
        <div class="gallery-item" onclick="loadAlbum('Gable End')">
            <img src="Gallery/Thumbnails/Gable End.jpeg" class="gallery-img-box">
            <span class="gallery-label">Gable End</span>
        </div>
        <div class="gallery-item" onclick="loadAlbum('Leanto')">
            <img src="Gallery/Thumbnails/Leanto.JPG" class="gallery-img-box">
            <span class="gallery-label">Leanto</span>
        </div>
        <div class="gallery-item" onclick="loadAlbum('Victorian')">
            <img src="Gallery/Thumbnails/Victorian.PNG" class="gallery-img-box">
            <span class="gallery-label">Victorian</span>
        </div>
    </div>

    <div id="sub-album-view" class="hidden" style="padding: 20px;">
        <button onclick="backToAlbums()" style="margin-bottom:20px; padding:10px 20px; background:#002f54; color:white; border:none; border-radius:30px;">← BACK</button>
        <div id="sub-grid" class="gallery-grid"></div>
    </div>

    <div id="photo-grid-view" class="hidden" style="padding: 20px;">
        <button onclick="backToSub()" id="back-to-sub-btn" style="margin-bottom:20px; padding:10px 20px; background:#002f54; color:white; border:none; border-radius:30px;">← BACK</button>
        <div id="final-photo-grid" class="gallery-grid"></div>
    </div>

    <div id="fs-overlay">
        <div class="fs-close" onclick="closeFS()"><i data-lucide="x-circle" size="40"></i></div>
        <img id="fs-img" src="">
        <div class="fs-nav">
            <button class="fs-btn" onclick="navFS(-1)"><i data-lucide="chevron-left"></i></button>
            <button class="fs-btn" onclick="navFS(1)"><i data-lucide="chevron-right"></i></button>
        </div>
    </div>

    <script>
        // Data for folders
        const albums = {
            "Edwardian": ["Edwardian Glass Roof", "Edwardian Solid Roof"],
            "Flat Roof": [],
            "Gable End": ["Gable Glass Roof", "Gable Solid Roof"],
            "Leanto": ["Leanto Glass Roof", "Leanto Solid Roof"],
            "Victorian": ["Victorian Glass Roof", "Victorian Solid Roof"]
        };

        let currentPhotos = [];
        let currentIndex = 0;

        function loadAlbum(name) {
            const subs = albums[name];
            if (subs.length === 0) {
                fetchPhotos(`Gallery/${name}`);
            } else {
                document.getElementById('album-view').style.display = 'none';
                const subView = document.getElementById('sub-album-view');
                subView.style.display = 'block';
                const grid = document.getElementById('sub-grid');
                grid.innerHTML = '';
                subs.forEach(s => {
                    grid.innerHTML += `
                        <div class="gallery-item" onclick="fetchPhotos('Gallery/${name}/${s}')">
                            <div style="background:#eee; aspect-ratio:4/3; border-radius:12px; display:flex; align-items:center; justify-content:center; border:1px solid #ddd;">
                                <i data-lucide="folder" style="color:#002f54"></i>
                            </div>
                            <span class="gallery-label">${s}</span>
                        </div>`;
                });
                lucide.createIcons();
            }
        }

        function fetchPhotos(path) {
            // UI Switches
            document.getElementById('album-view').style.display = 'none';
            document.getElementById('sub-album-view').style.display = 'none';
            document.getElementById('photo-grid-view').style.display = 'block';
            
            const grid = document.getElementById('final-photo-grid');
            grid.innerHTML = 'Loading images...';
            currentPhotos = [];

            // Attempt to load 01 through 10 with various extensions
            const exts = ['.jpg', '.JPG', '.jpeg', '.png', '.PNG'];
            let count = 0;

            for (let i = 1; i <= 12; i++) {
                let found = false;
                let fileName = i.toString().padStart(2, '0');
                exts.forEach(ext => {
                    const img = new Image();
                    img.onload = () => {
                        if (count === 0) grid.innerHTML = '';
                        currentPhotos.push(img.src);
                        const idx = currentPhotos.length - 1;
                        grid.innerHTML += `<img src="${img.src}" class="gallery-img-box" onclick="openFS(${idx})">`;
                        count++;
                    };
                    img.src = `${path}/${fileName}${ext}`;
                });
            }
        }

        function openFS(idx) {
            currentIndex = idx;
            document.getElementById('fs-img').src = currentPhotos[currentIndex];
            document.getElementById('fs-overlay').style.display = 'flex';
            lucide.createIcons();
        }

        function closeFS() { document.getElementById('fs-overlay').style.display = 'none'; }

        function navFS(dir) {
            currentIndex = (currentIndex + dir + currentPhotos.length) % currentPhotos.length;
            document.getElementById('fs-img').src = currentPhotos[currentIndex];
        }

        function backToAlbums() {
            document.getElementById('sub-album-view').style.display = 'none';
            document.getElementById('album-view').style.display = 'grid';
        }

        function backToSub() {
            document.getElementById('photo-grid-view').style.display = 'none';
            document.getElementById('album-view').style.display = 'grid'; // Simplest reset
        }

        // Swipe Detection
        let tStart = 0;
        document.getElementById('fs-overlay').addEventListener('touchstart', e => tStart = e.touches[0].clientX);
        document.getElementById('fs-overlay').addEventListener('touchend', e => {
            let tEnd = e.changedTouches[0].clientX;
            if (tEnd < tStart - 50) navFS(1);
            if (tEnd > tStart + 50) navFS(-1);
        });
    </script>
</div>
